import { spawnSync } from "child_process";
import { release } from "os";

const PNG_WHITE = 'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAAXNSR0IArs4c6QAAALhlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEyAAIAAAAUAAAAWodpAAQAAAABAAAAbgAAAAAAAABIAAAAAQAAAEgAAAABMjAyMTowOToxOSAxODoyMjozMQAABJAEAAIAAAAUAAAApKABAAMAAAABAAEAAKACAAQAAAABAAAAGKADAAQAAAABAAAAGAAAAAAyMDIxOjA4OjA5IDAzOjIyOjM5AMJONIYAAAAJcEhZcwAACxMAAAsTAQCanBgAAAegaVRYdFhNTDpjb20uYWRvYmUueG1wAAAAAAA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJYTVAgQ29yZSA2LjAuMCI+CiAgIDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+CiAgICAgIDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiCiAgICAgICAgICAgIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIKICAgICAgICAgICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgICAgICAgICB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIKICAgICAgICAgICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgICAgICAgICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgICAgICAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyI+CiAgICAgICAgIDxkYzpmb3JtYXQ+aW1hZ2UvcG5nPC9kYzpmb3JtYXQ+CiAgICAgICAgIDx4bXA6TW9kaWZ5RGF0ZT4yMDIxLTA5LTE5VDE4OjIyOjMxKzAxOjAwPC94bXA6TW9kaWZ5RGF0ZT4KICAgICAgICAgPHhtcDpDcmVhdGVEYXRlPjIwMjEtMDgtMDlUMDM6MjI6MzkrMDE6MDA8L3htcDpDcmVhdGVEYXRlPgogICAgICAgICA8eG1wOk1ldGFkYXRhRGF0ZT4yMDIxLTA5LTE5VDE4OjIyOjMxKzAxOjAwPC94bXA6TWV0YWRhdGFEYXRlPgogICAgICAgICA8eG1wTU06SGlzdG9yeT4KICAgICAgICAgICAgPHJkZjpTZXE+CiAgICAgICAgICAgICAgIDxyZGY6bGkgcmRmOnBhcnNlVHlwZT0iUmVzb3VyY2UiPgogICAgICAgICAgICAgICAgICA8c3RFdnQ6c29mdHdhcmVBZ2VudD5BZG9iZSBQaG90b3Nob3AgMjEuMCAoTWFjaW50b3NoKTwvc3RFdnQ6c29mdHdhcmVBZ2VudD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OmNoYW5nZWQ+Lzwvc3RFdnQ6Y2hhbmdlZD4KICAgICAgICAgICAgICAgICAgPHN0RXZ0OndoZW4+MjAyMS0wOS0xOVQxODoyMjozMSswMTowMDwvc3RFdnQ6d2hlbj4KICAgICAgICAgICAgICAgICAgPHN0RXZ0Omluc3RhbmNlSUQ+eG1wLmlpZDoxOTAzMmE1NS01YzJkLTQ0N2EtYWVkYi0xMWE3YmZlMzE3NjI8L3N0RXZ0Omluc3RhbmNlSUQ+CiAgICAgICAgICAgICAgICAgIDxzdEV2dDphY3Rpb24+c2F2ZWQ8L3N0RXZ0OmFjdGlvbj4KICAgICAgICAgICAgICAgPC9yZGY6bGk+CiAgICAgICAgICAgIDwvcmRmOlNlcT4KICAgICAgICAgPC94bXBNTTpIaXN0b3J5PgogICAgICAgICA8eG1wTU06T3JpZ2luYWxEb2N1bWVudElEPnhtcC5kaWQ6MTkwMzJhNTUtNWMyZC00NDdhLWFlZGItMTFhN2JmZTMxNzYyPC94bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ+CiAgICAgICAgIDx4bXBNTTpEb2N1bWVudElEPnhtcC5kaWQ6MTkwMzJhNTUtNWMyZC00NDdhLWFlZGItMTFhN2JmZTMxNzYyPC94bXBNTTpEb2N1bWVudElEPgogICAgICAgICA8eG1wTU06SW5zdGFuY2VJRD54bXAuaWlkOjE5MDMyYTU1LTVjMmQtNDQ3YS1hZWRiLTExYTdiZmUzMTc2MjwveG1wTU06SW5zdGFuY2VJRD4KICAgICAgICAgPHBob3Rvc2hvcDpJQ0NQcm9maWxlPnNSR0IgSUVDNjE5NjYtMi4xPC9waG90b3Nob3A6SUNDUHJvZmlsZT4KICAgICAgICAgPHBob3Rvc2hvcDpDb2xvck1vZGU+MzwvcGhvdG9zaG9wOkNvbG9yTW9kZT4KICAgICAgICAgPHRpZmY6T3JpZW50YXRpb24+MTwvdGlmZjpPcmllbnRhdGlvbj4KICAgICAgICAgPHRpZmY6WFJlc29sdXRpb24+NzI8L3RpZmY6WFJlc29sdXRpb24+CiAgICAgICAgIDx0aWZmOllSZXNvbHV0aW9uPjcyPC90aWZmOllSZXNvbHV0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KX29lRQAABQ1JREFUSA3tVO1Pk1cUv8/T9nmeFrCUUgqlQnmRVlscKAYoQ0g0S8aWffDDkmkWhkuY0aqLI3NuJsaNJTNkLOGLAc2AxLEPsLFky0g2Eo2gOBQLhY51oiBS3ubwnb7R5+6cqyXOmewf8CR9eu89v/M75557ziHkhfxPBrjn6HlCtFqVSrAoFLI+GuXuRCLhSULu3yckV0HICthMRRMSErTBoJDF8zRRlvm/ATMFmLvAJz/NqXxqwxUUVGq93rFck8nwqsu19y2z2ZSytHR7qb6+4ac7d8TbFotWx/M85/eHlvR6fcrhw4de1+kSdTMzs4tNTSe/9fsXfrbbHRPDw+fuAS9F7tgN+M2btyeMjY2U1dZWN+7Z8651ZGSMjI//QSyWTOJ0FhMgIhzHEVmWSTgcJgsLi8Tt9pDZ2TmSl5dLNm50kJaWVl9LS/shh+OlC0NDvQ+An92Ga2pqEgVBt7G6utZLQc6d66ODg0O4pNFolI6OsmO2f95ncPAKPXv2PFMhB3K1trZKqxcwmTZrRFHvunLFzUAQ5SrPqVNtFHTfFRdXdu7evXfm5MnTFG5HQ6HQKgYXGAgKciAXIWY1poiJJBmzd+zYyUKOkS8vB5jBvn2HFlSq5KL4+FQDRiaKya+JYtLBsrJt37tcdYttbWfo/PwCw8ZskQs5Y/xEFA1VkD8GgvzSGHBlZYU6ndu64+ONKc3NzZr9+/eLjY2NaoulUoqLSzGiY0lK6ujvH2C2saCam7+GWxiqnjjIFXW6tZ9cvz7JQEgaiUTYGnMP0b6PhBpNskmjMVShoVqtT0eHUKr6LVu2nnn0aJnhMTiUGzemqFab9jGUtchrNHf1xcVF27KzLcwhlCGrFNxcvPgbfPmJAwfe4KAfCnp7f+zs6+vpUirFTQMDA3IopEyz29eXaTRqAm9AlEolAX6SlZVJSkpKtiM3H4mQ1PXr8wqRECLHP6JQQD+BXL485Ifnm56cnJQVCp4XRYmXJInHMq2oqMCyNW/aVGBBLKSVlTFkALfEbrcVAl2akuejRpvNmoiH6B1/6ABJxsd9lwRBnHM4HApKO9xO5/Y31WoJbOThmpoaGaolx+ksQdP/iM2Wlwg9aVRyHK9fty6HATA96ADF7R4hQ0PuYDTKp9fV1d0KBB78BQ/c6/F4aGlpKQ9na6xWx8sOxwaGj32wGVGQk+PkJCXwrUlJMcT0BJ2gZGSsJQ0Nn+8aHh4t93hG+z0eb/+RI/UTlHIzbW3d8yqVZC4oyC8XRYEEgyEiSeIqBy4MhmQIlqyBWcRFMzMzmBK9X7t2nWAeN2ywEZfrPTzPePjw0U6v9/ed/f2XyNWrwxOwvuTz/akoKipMRwCSQzpZcLFsPObkoqA0bD1x4qsHkBomEA3t6OikR49+Snt6fqWBQDCm+tc/zCHq98/S8+cvMCzaoG1MkBO5IWGJiYLAv1JdvevLY8c+MqenmzAo4vNdI6dPt0MluactFnMkNdVoUIPgNIWSDN67d3/R6x3n8vPtWbW1NcRqXcfswCk5fvyLmfb2bz4Ih+Vf2CFMUpj/yUVGY9ZnBw9+ONfV9QOFtNDp6Vsr0LFvC4Lehnq1WlcGUZWr1UklMDby4+IM79y8Ob2CjdbZ2U3R1mjMqVep9FuQE8lj4/rJOilBEKgFjq3wHmlw3Xmo2IuBwNIMAp4VcGSG/nICNhWwc1DovnCYmyJkCUf143J81ujF/tkM/ANJuNdml72sLQAAAABJRU5ErkJggg=='
const PNG_BLACK = 'iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAAXNSR0IB2cksfwAAAAlwSFlzAAALEwAACxMBAJqcGAAAAkNQTFRFAAAA///////w+vrq9/fs+vrr///x///////b///f////8vLy+vrs+Pjt+vrr////z8+/+vrr4ODWdHRsWFhSampm5ubb9/fq19fM1dXK8PDm3d3TZmZhVVVRcXFr39/UzMy7+PjqkpKLKiooWVlUgoJ8YmJdKCgmFxcWFhYVGBgXHh4dNTUzZmZhgIB6WlpWLCwqbW1t+fnuoKCZAAAAPz88NTUyAgICQEA9YGBg5eXM+PjsMzMwAQEBZGRf+PjsyMi/nZ2VaGhjLi4rBgYG///j9/fora2lCQkIlJSN8/Pn+Pjr+PjtxMS8k5OLX19bZWVgBQUFAwMDxcW88/PoZmZmkpKScXFx39+/9PTp9/ftOzs47u7iIiIgBAQE+Pjt9fXr9fXq9vbs8vLyysrBCgoJISEft7eu+PjrOTk3NTUz8vLln5+f+fnun5+YuLiujo6Im5uU9fXoMjIvLS0r+Pjr+PjtbW1ojY2G+PjuxMS77+/j9vbt////+Pjs9/fsQUE+Nzc19/fs+vrqy8vABwcG+PjsKyspGRkYbGxnnJyUysrB+Pjs+fnsm5uTCAgH+PjrDAwLJiYkc3NtpaWd0NDHZ2diKSknJycl9/fqdnZwg4N9SEhEMDAtGhoZPT06///v+fntmpqSGxsai4uEwMC1oKCZiIiCf395fX13gIB6j4+IurqxjY2G6OjekJCJU1NPCwsKHR0c9PTp+fns9vbu9/fq9vbt+fnu9PTqHh4dVFRQ6Ojc///t+fnt+Pjs9vbtqWVlGAAAAMF0Uk5TAAIRMUQzEgQHCAUUNUUyARA0fdbs2o56i4x6kNzt134PStj//////////////////wcu1f//////CAps////ravk////CSLN/+kVS2+u6v////+vFgoHCQgXpv97//9wGkobE6T//75M9fZNCCzfvu/kTPf4TUj/70msUR0Ga1z//6Qwp/9q////4aVpKeT/Z////9uj////PvP//////xBW4///4dzx+vvz3d7/g+f///xdKDs9OC1g/P+EDlVuHHcuMD8AAAGsSURBVHicY2CgLmBkYmZhZWPn4OTi5uHlY2OECvMLCAoJi4iKiUtISknLyMrJCwrwg5UrKCopq6iqqWtoamnr6OrpGygpKgA18RsaGZuYmpmYG5hAgI6FibGRJVCPlbWNia2JiZ29g6OTswtQxtzExtoVaJSbO1Dcw8RT0MvI28fXz18DyHV3A0ooBpgE2poEBYeEhoVHRApGRQNV6SoyMHDExJoExZkYxEckJComhSanpJoEmqRJcTAkpJuY2LqY6GaEK2ZmZefk5pkE2dqa5Ccw8BUATQoyKTQKKyouKbUsKwdqCDSpYGWo1DVxMTdxqfIKTSqtrqmtswFLBCgy1DeYxAWZNDY1J9eG54Ryt7QCheNMLOoZ2tpN4mxNOjq7unt4e5ma+0z6TYAS7W0MEyaaBE1SBvprYuPkKVOjppmYTJ9hbjJxAsPMWSYmrSqz5/SDw2PuvPmzVVpNTGbNZFiwcNFiE5MZS5YuW75i5arVa9bOMDFZvGjhAgYGBcF16zds3LR5i+DWbdt37NyVunv9Hh4FcHzsNdq3f+EBSOQcWLh/n9FefqqmAwCpZH5QVFmsZAAAAABJRU5ErkJggg=='
const ICO_BLRPL = 'AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPJlWP/yZVj/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8mVY//JlWP8AAAAAAAAAAAAAAAAAAAAA8mVY//JlWP/yZVj/AAAAAAAAAADyZVj/8mVY//JlWP/yZVj/AAAAAAAAAAAAAAAA8mVY//JlWP8AAAAA8mVY//JlWP/yZVj/8mVY//JlWP/yZVj/8mVY//JlWP/yZVj/AAAAAPJlWP/yZVj/8mVY/wAAAADyZVj/8mVY//JlWP/yZVj/8mVY//JlWP8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA8mVY//JlWP/yZVj/8mVY//JlWP/yZVj/8mVY//JlWP/yZVj/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAPJlWP/yZVj/8mVY//JlWP/yZVj/8mVY//JlWP/yZVj/8mVY//JlWP8AAAAAAAAAAPJlWP/yZVj/AAAAAAAAAADyZVj/8mVY//JlWP/yZVj/8mVY/wAAAADyZVj/8mVY//JlWP/yZVj/AAAAAAAAAADyZVj/8mVY/wAAAAAAAAAA8mVY//JlWP/yZVj/8mVY/wAAAAAAAAAA8mVY//JlWP/yZVj/8mVY/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADyZVj/8mVY//JlWP8AAAAAAAAAAPJlWP/yZVj/8mVY//JlWP8AAAAAAAAAAAAAAAAAAAAAAAAAAPJlWP/yZVj/8mVY//JlWP/yZVj/AAAAAAAAAAAAAAAA8mVY//JlWP/yZVj/8mVY/wAAAADyZVj/8mVY//JlWP/yZVj/8mVY//JlWP/yZVj/AAAAAAAAAAAAAAAAAAAAAPJlWP8AAAAAAAAAAPJlWP/yZVj/8mVY//JlWP/yZVj/8mVY/wAAAAAAAAAA8mVY/wAAAAAAAAAAAAAAAAAAAAAAAAAA8mVY//JlWP/yZVj/AAAAAAAAAAAAAAAAAAAAAPJlWP/yZVj/8mVY/wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA//8AAP//AADn5wAAjDkAAABEAAAP4AAAD+AAAAZgAACGYQAAh/EAAIfBAADCAwAA2BsAAOPHAAD//wAA//8AAA==' 

let icon = ICO_BLRPL;

function checkDarkMode() {
    const dark = spawnSync("/usr/bin/plutil", ["-extract", "AppleInterfaceStyle", "xml1", process.env.HOME + "/Library/Preferences/.GlobalPreferences.plist", "-o", "-"]).stdout.toString()
    console.log("[Icon]", dark, "mode");
    return dark.includes("Dark");
}

if (process.platform == "darwin") {
    var darwinVersion = parseInt(release().split(".")[0]);
    if (darwinVersion >= 20) // Big Sur's design always uses white menu bar icons
        icon = PNG_WHITE;
    else if (darwinVersion >= 18) // Mojave & Catalina uses themed icons based on user preference
        icon = checkDarkMode() ? PNG_WHITE : PNG_BLACK;
    else // High Sierra & earlier always have black menu bar icons
        icon = PNG_BLACK
}

export default icon;
    